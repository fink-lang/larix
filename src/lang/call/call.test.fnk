{describe, it, eq, to_throw, snapshot} = import '../../testing/jest'

{parse_expr} = import '../..'


describe:: 'call()', fn:

  it:: 'parses empty: foobar()', fn:
    parse_expr(`foobar()`) eq snapshot


  it:: 'parses single arg: foobar(1)', fn:
    parse_expr(`foobar(1)`) eq snapshot


  it:: 'parses multiple args: foobar(1, 2)', fn:
    parse_expr(`foobar(1, 2)`) eq snapshot


describe:: 'call() - parsing failures', fn:

  it:: `throws when missing ')'`, fn:
    (
      fn: parse_expr(`foobar(`, 'test.fnk')
    ) to_throw `
      test.fnk:1:7
      1| foobar(
                ^

      Expected ')' but found Symbol(end).`


  it:: `throws when missing ')'`, fn:
    (
      fn: parse_expr(`foobar(1:)`, 'test.fnk')
    ) to_throw `
      test.fnk:1:8
      1| foobar(1:)
                 ^

      Expected ')' but found ':'.`


describe:: 'call:: ...', fn:

  it:: 'parses single line', fn:
    parse_expr(`foobar:: spam, ni`) eq snapshot


  it:: 'parses multiline', fn:
    parse_expr(`
      foo::
        fn bar:
          spam
        ni
        shrub
    `) eq snapshot

  it:: 'parses multiline with comma (TODO)', fn:
    parse_expr(`
      foo::
        bar,
        ni,
        shrub
    `) eq snapshot


describe:: 'pipe foo: ...', fn:

  it:: 'pipes', fn:
    parse_expr(`
      pipe foo:
        bar(shrub)
        ni
    `) eq snapshot

