{describe, it, expect, to_match_snapshot, to_throw} = import '../../testing/jest'

{parse_expr} = import '../..'


describe:: 'call()', fn:

  it:: 'parses empty: foobar()', fn:
    expect::
      parse_expr:: `foobar()`
      to_match_snapshot


  it:: 'parses single arg: foobar(1)', fn:
    expect::
      parse_expr:: `foobar(1)`
      to_match_snapshot


  it:: 'parses multiple args: foobar(1, 2)', fn:
    expect::
      parse_expr:: `foobar(1, 2)`
      to_match_snapshot


describe:: 'call() - parsing failures', fn:

  it:: `throws when missing ')'`, fn:
    expect::
      fn: parse_expr:: `foobar(`, 'test.fnk'
      to_throw:: `
        test.fnk:1:7
        1| foobar(
                  ^

        Expected ')' but found Symbol(end).`


  it:: `throws when missing ')'`, fn:
    expect::
      fn: parse_expr:: `foobar(1:)`, 'test.fnk'
      to_throw:: `
        test.fnk:1:8
        1| foobar(1:)
                   ^

        Expected ')' but found ':'.`


describe:: 'call:: ...', fn:

  it:: 'parses single line', fn:
    expect::
      parse_expr:: `foobar:: spam, ni`
      to_match_snapshot


  it:: 'parses multiline', fn:
    expect::
      parse_expr:: `
        foo::
          fn bar:
            spam
          ni
          shrub
          # trailing comment
      `
      to_match_snapshot

  it:: 'parses multiline with comma (TODO)', fn:
    expect::
      parse_expr:: `
        foo::
          bar,
          ni,
          shrub
      `
      to_match_snapshot


describe:: 'pipe foo: ...', fn:

  it:: 'pipes', fn:
    expect::
      parse_expr:: `
        pipe foo:
          bar:: shrub
          ni
      `
      to_match_snapshot

