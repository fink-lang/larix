{next_is, collect_text, expression} = import '@fink/prattler'

{symbol} = import '../symbols'


doc_comment = fn op:
  {
    ...symbol(op),

    nud: fn: fn ctx:
      [text, expr_ctx] = collect_text(ctx, '---')
      [{comments, ...expr}, next_ctx] = expression(expr_ctx, 0)
      # TODO: 'comment' is for backwards compat v4.x
      [{...expr, comment: text, comments: {...comments, leading: text}}, next_ctx]
  }
