{describe, it, expect, to_match_snapshot} = import '@fink/jest'

{parse, parse_expr} = import '../../'


describe 'regex rx/.../', fn:

  it 'parses empty: rx//', fn:
    expect
      parse_expr `rx//`
      to_match_snapshot


  it 'parses multiline', fn:
    expect
      parse_expr `
        rx/
          foo.+bar
        /
      `
      to_match_snapshot


  it 'parses flags: rx//gimsuy', fn:
    expect
      parse_expr `rx//gimsuy`
      to_match_snapshot


  it 'parses regex: rx/.+foo/', fn:
    expect
      parse_expr `rx/.+foo/gimsuy`
      to_match_snapshot


  it 'parses escaped chars: rx/\\n\\t/', fn:
    expect
      parse_expr `rx/\\n \\\\ \\/ \\\\/`
      to_match_snapshot


describe 'regex - parsing failures', fn:

  it 'errors when missing end', fn:
    expect
      parse `rx/foo.bar`, 'test.fnk'
      to_match_snapshot


  it 'errors unssupported flags', fn:
    expect
      parse `rx/foo.bar/n`, 'test.fnk'
      to_match_snapshot
